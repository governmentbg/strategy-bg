@model Models.ViewModels.PCSubjectsModels.PCSubjectsViewModel

@{
    ViewData["Title"] = "Лице съгласно ЗНА";
}

<section class="content">
    <div class="row">
        <div class="col-lg-6">
            <form asp-action="EditPCSubjects">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                @Html.HiddenFor(m => m.Id)
                @Html.HiddenFor(m => m.DateCreated)
                @Html.HiddenFor(m => m.CreatedByUserId)
                @Html.HiddenFor(m => m.ModifiedByUserId)
                @Html.HiddenFor(m => m.DateModified)

                <div class="row">
                    <div class="col-lg-3">
                        @Html.LabelFor(m => m.IsUL, "Вид лице")
                    </div>
                    <div class="col-lg-5">
                        @Html.DropDownList("IsUL", (List<SelectListItem>)ViewBag.PCSubjectsTypeID_ddl)
                    </div>
                </div>

                <div id="eik_div">
                    @Html.EditorFor(m => m.EIK, new { htmlAttributes = new { @class = "form-control" } })
                </div>

                @Html.EditorFor(m => m.Name, new { htmlAttributes = new { @class = "form-control" } })

                @Html.EditorFor(m => m.DatePayment)
                @Html.EditorFor(m => m.PaymentValue)
                @Html.EditorFor(m => m.ActivityDescription)
                <div class="form-group">
                    <input type="submit" value="Запис" class="btn btn-success btn-flat" />
                    <a asp-action="ListPCSubjects" class="btn btn-danger btn-flat">Назад</a>
                </div>
            </form>
        </div>
    </div>
</section>
@section scripts{
    <script>
        $(function () {
            SetSubjectType();

            $('#IsUL').change(function () {
                SetSubjectType();
            });

            $("#EIK").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '@Url.Action("LoadDataPCSubjectsAutocompleteEIK")',
                        type: "GET",
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data) {
                            response($.map(data, function (item) {
                                return { name: item.name, value: item.eik, label: item.activityDescription };
                            }))
                        }
                    })
                },
                minLength: 3,
                select: function (event, ui) {
                    $("#Name").val(ui.item.name);
                }
            });

            $("#Name").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '@Url.Action("LoadDataPCSubjectsAutocompleteName")',
                        type: "GET",
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data) {
                            response($.map(data, function (item) {
                                return { name: item.eik, value: item.name, label: item.activityDescription };
                            }))
                        }
                    })
                },
                minLength: 3,
                select: function (event, ui) {
                    $("#EIK").val(ui.item.name);
                }
            });
        });

        function SetSubjectType() {
            if ($('#IsUL').val() == "1") {
                $('#eik_div').show();
            }
            else {
                $('#eik_div').hide();
                $('#eik').val("");
            }
        }
    </script>
}

